{% extends "email/base.html" %}

{% block title %}Order Status Update - #{{ order.number }}{% endblock %}

{% block content %}
<h2>Order Status Update</h2>
<p>Dear {{ customer.name }},</p>

<p>
    There has been an update to your order #{{ order.number }}. 
    Your order is now <strong>{{ order.status }}</strong>.
</p>

<div style="background-color: #f8f9fa; padding: 20px; border-radius: 4px; margin: 20px 0;">
    <div style="margin-bottom: 20px;">
        <h4 style="margin: 0 0 10px 0;">Order Timeline</h4>
        <div style="display: flex; justify-content: space-between; position: relative;">
            <div style="border-top: 2px solid #dee2e6; position: absolute; width: 100%; top: 15px;"></div>
            {% for step in order.timeline %}
            <div style="text-align: center; position: relative; z-index: 1;">
                <div style="
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    background-color: {{ 'var(--bs-primary)' if step.completed else '#fff' }};
                    border: 2px solid {{ 'var(--bs-primary)' if step.completed else '#dee2e6' }};
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto;
                    color: {{ '#fff' if step.completed else '#666' }};
                ">
                    <i class="fas fa-{{ step.icon }}"></i>
                </div>
                <div style="
                    font-size: 12px;
                    color: {{ '#000' if step.completed else '#666' }};
                    margin-top: 5px;
                ">
                    {{ step.name }}
                </div>
                {% if step.completed %}
                <div style="font-size: 10px; color: #666; margin-top: 2px;">
                    {{ step.date|date }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    {% if order.tracking_number %}
    <div style="text-align: center; margin: 20px 0;">
        <h4>Tracking Information</h4>
        <p style="margin: 5px 0;">
            {{ order.shipping_carrier }} - {{ order.tracking_number }}
        </p>
        <a href="{{ order.tracking_url }}" class="button">Track Package</a>
    </div>
    {% endif %}

    <div style="margin-top: 20px;">
        <h4 style="margin: 0 0 10px 0;">Order Details</h4>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #dee2e6;">
                    <th style="text-align: left; padding: 8px;">Item</th>
                    <th style="text-align: center; padding: 8px;">Quantity</th>
                    <th style="text-align: right; padding: 8px;">Price</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 8px;">
                        {{ item.name }}
                        {% if item.options %}
                        <br>
                        <small style="color: #666;">
                            {{ item.options|join(', ') }}
                        </small>
                        {% endif %}
                    </td>
                    <td style="text-align: center; padding: 8px;">{{ item.quantity }}</td>
                    <td style="text-align: right; padding: 8px;">
                        ${{ item.total|format_currency }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2" style="text-align: right; padding: 8px;">
                        <strong>Subtotal:</strong>
                    </td>
                    <td style="text-align: right; padding: 8px;">
                        ${{ order.subtotal|format_currency }}
                    </td>
                </tr>
                {% if order.shipping_cost %}
                <tr>
                    <td colspan="2" style="text-align: right; padding: 8px;">
                        Shipping:
                    </td>
                    <td style="text-align: right; padding: 8px;">
                        ${{ order.shipping_cost|format_currency }}
                    </td>
                </tr>
                {% endif %}
                {% if order.tax_amount %}
                <tr>
                    <td colspan="2" style="text-align: right; padding: 8px;">
                        Tax:
                    </td>
                    <td style="text-align: right; padding: 8px;">
                        ${{ order.tax_amount|format_currency }}
                    </td>
                </tr>
                {% endif %}
                <tr>
                    <td colspan="2" style="text-align: right; padding: 8px;">
                        <strong>Total:</strong>
                    </td>
                    <td style="text-align: right; padding: 8px;">
                        <strong>${{ order.total|format_currency }}</strong>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div style="text-align: center; margin-top: 20px;">
    <a href="{{ order_url }}" class="button">View Order Details</a>
    {% if order.status == 'delivered' %}
    <a href="{{ review_url }}" class="button" style="margin-left: 10px;">
        Write a Review
    </a>
    {% endif %}
</div>

{% if order.next_steps %}
<div style="background-color: #e8f5e9; padding: 15px; border-radius: 4px; margin-top: 20px;">
    <h4 style="margin-top: 0; color: #2e7d32;">Next Steps</h4>
    <ul style="list-style: none; padding: 0; margin: 0;">
        {% for step in order.next_steps %}
        <li style="margin-bottom: 8px;">
            <i class="fas fa-{{ step.icon }}"></i> {{ step.message }}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<p style="margin-top: 20px;">
    If you have any questions about your order, please contact our customer support
    team at {{ company.support_email }} or call {{ company.phone }}.
</p>
{% endblock %} 